name: moremouse
channels:
  - pytorch
  - nvidia
  - conda-forge
  - defaults

dependencies:
  # Python
  - python=3.10

  # PyTorch with CUDA 11.8 (compatible with gpu05)
  - pytorch=2.0.1
  - torchvision=0.15.2
  - torchaudio=2.0.2
  - pytorch-cuda=11.8

  # Core dependencies
  - numpy>=1.23.0,<2.0  # torch 2.0.x requires numpy 1.x
  - scipy>=1.10.0
  - matplotlib>=3.7.0

  # Pip packages
  - pip
  - pip:
    # Gaussian Splatting
    - gsplat>=1.5.0

    # Config management
    - hydra-core>=1.3.0
    - omegaconf>=2.3.0

    # Deep learning
    - transformers>=4.35.0  # For DINOv2
    - timm>=0.9.0

    # 3D processing
    - trimesh>=4.0.0
    - pyglet<2  # For trimesh visualization
    - networkx>=3.0  # For geodesic computation
    - potpourri3d>=0.0.8  # Heat method for geodesics

    # NeRF/DMTet dependencies
    # NOTE: torch-scatter and kaolin require special installation (see below)
    # They are installed separately via post_install.sh

    # Data handling
    - zarr>=2.13.0
    - h5py>=3.8.0
    - opencv-python>=4.7.0
    - Pillow>=9.5.0
    - imageio>=2.31.0
    - imageio-ffmpeg>=0.4.8

    # Metrics
    - torchmetrics>=0.11.0
    - lpips>=0.1.4

    # Logging (optional)
    - wandb>=0.15.0
    - tensorboard>=2.13.0

    # Environment
    - python-dotenv>=1.0.0

    # Utilities
    - tqdm>=4.65.0
    - joblib>=1.2.0
    - einops>=0.7.0
    - rich>=13.0.0  # Better terminal output

# ============================================================
# Installation instructions:
# ============================================================
#
# IMPORTANT: Use the install script for correct order!
#
#   chmod +x scripts/install.sh
#   ./scripts/install.sh
#
# Or manual installation:
#
#   1. Create environment (without torch-scatter/kaolin)
#      conda env create -f environment.yml
#      conda activate moremouse
#
#   2. Install torch-scatter (pre-built wheel for PyTorch 2.0 + CUDA 11.8)
#      pip install torch-scatter -f https://data.pyg.org/whl/torch-2.0.0+cu118.html
#
#   3. Install kaolin (pre-built wheel for PyTorch 2.0.1 + CUDA 11.8)
#      pip install kaolin==0.15.0 -f https://nvidia-kaolin.s3.us-east-2.amazonaws.com/torch-2.0.1_cu118.html
#
# ============================================================
# Troubleshooting:
# ============================================================
#
# NumPy version conflict:
#   pip install "numpy<2.0" --force-reinstall
#
# gsplat CUDA compilation issues:
#   export CUDA_HOME=/usr/local/cuda-11.8
#   pip install gsplat --no-cache-dir
#
# torch-scatter build failure (ModuleNotFoundError: torch):
#   - This means PyTorch wasn't installed first
#   - Use pre-built wheel: pip install torch-scatter -f https://data.pyg.org/whl/torch-2.0.0+cu118.html
